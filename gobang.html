<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éœ“è™¹äº”å­æ£‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        :root {
            --neon-blue: #0ff0fc;
            --neon-pink: #ff00ff;
            --neon-purple: #9467fd;
            --neon-green: #00ff7f;
        }
        
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #0a0a1a;
            color: white;
            overflow-x: hidden;
        }
        
        .neon-text-blue {
            color: var(--neon-blue);
            text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue);
        }
        
        .neon-text-pink {
            color: var(--neon-pink);
            text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink);
        }
        
        .neon-border-blue {
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue), inset 0 0 5px var(--neon-blue);
        }
        
        .neon-border-pink {
            border: 2px solid var(--neon-pink);
            box-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink), inset 0 0 5px var(--neon-pink);
        }
        
        .neon-border-purple {
            border: 2px solid var(--neon-purple);
            box-shadow: 0 0 5px var(--neon-purple), 0 0 10px var(--neon-purple), inset 0 0 5px var(--neon-purple);
        }
        
        .neon-border-green {
            border: 2px solid var(--neon-green);
            box-shadow: 0 0 5px var(--neon-green), 0 0 10px var(--neon-green), inset 0 0 5px var(--neon-green);
        }
        
        .neon-btn-blue {
            background-color: transparent;
            color: var(--neon-blue);
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue);
            transition: all 0.3s;
        }
        
        .neon-btn-blue:hover {
            background-color: var(--neon-blue);
            color: #0a0a1a;
            box-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue), 0 0 30px var(--neon-blue);
        }
        
        .neon-btn-pink {
            background-color: transparent;
            color: var(--neon-pink);
            border: 2px solid var(--neon-pink);
            box-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink);
            transition: all 0.3s;
        }
        
        .neon-btn-pink:hover {
            background-color: var(--neon-pink);
            color: #0a0a1a;
            box-shadow: 0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink), 0 0 30px var(--neon-pink);
        }
        
        .board {
            background-color: rgba(10, 10, 26, 0.7);
            position: relative;
        }
        
        .grid-line {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .piece {
            position: absolute;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s;
        }
        
        .black-piece {
            background: radial-gradient(circle at 30% 30%, #555, #000);
            box-shadow: 0 0 10px #000, inset 0 0 5px #333;
        }
        
        .white-piece {
            background: radial-gradient(circle at 30% 30%, #fff, #ddd);
            box-shadow: 0 0 10px #fff, inset 0 0 5px #aaa;
        }
        
        .black-piece.neon {
            box-shadow: 0 0 10px #000, 0 0 20px var(--neon-blue), inset 0 0 5px #333;
        }
        
        .white-piece.neon {
            box-shadow: 0 0 10px #fff, 0 0 20px var(--neon-pink), inset 0 0 5px #aaa;
        }
        
        .last-move {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        .win-line {
            position: absolute;
            background-color: var(--neon-green);
            box-shadow: 0 0 5px var(--neon-green), 0 0 10px var(--neon-green);
            transform-origin: 0 0;
            z-index: 10;
        }
        
        .glow {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1), transparent 70%);
            pointer-events: none;
            z-index: -1;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: #0a0a1a;
            padding: 2rem;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .radio-container {
            display: flex;
            justify-content: center;
            margin: 1rem 0;
        }
        
        .radio-option {
            margin: 0 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        input[type="radio"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--neon-blue);
            border-radius: 50%;
            margin-bottom: 0.5rem;
            cursor: pointer;
            position: relative;
        }
        
        input[type="radio"]:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background-color: var(--neon-blue);
            border-radius: 50%;
            box-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue);
        }
        
        .difficulty-selector {
            margin: 1rem 0;
        }
        
        select {
            background-color: #0a0a1a;
            color: white;
            border: 2px solid var(--neon-purple);
            padding: 0.5rem;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
            box-shadow: 0 0 5px var(--neon-purple);
        }
        
        .game-mode-btn {
            margin: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .player-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 5px;
        }
        
        .active-player {
            animation: glow-pulse 2s infinite;
        }
        
        @keyframes glow-pulse {
            0% { box-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue); }
            50% { box-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue); }
            100% { box-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue); }
        }
        
        .active-player.white {
            animation: glow-pulse-white 2s infinite;
        }
        
        @keyframes glow-pulse-white {
            0% { box-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink); }
            50% { box-shadow: 0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink); }
            100% { box-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink); }
        }
        
        .controls {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }
        
        .control-btn {
            margin: 0 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
    <div class="glow"></div>
    
    <h1 class="text-3xl md:text-4xl mb-6 neon-text-blue">éœ“è™¹äº”å­æ£‹</h1>
    
    <div class="game-info w-full max-w-md mb-4">
        <div id="black-player" class="player-info neon-border-blue">
            <span class="neon-text-blue">é»‘æ£‹</span>
            <span id="black-name" class="text-sm">ç©å®¶</span>
        </div>
        <div class="flex items-center">
            <span id="game-status" class="neon-text-purple">å‡†å¤‡å¼€å§‹</span>
        </div>
        <div id="white-player" class="player-info neon-border-pink">
            <span class="neon-text-pink">ç™½æ£‹</span>
            <span id="white-name" class="text-sm">AI</span>
        </div>
    </div>
    
    <div class="board relative w-full max-w-md h-96 md:h-[28rem] neon-border-purple mb-4">
        <!-- æ£‹ç›˜å’Œæ£‹å­å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>
    
    <div class="controls">
        <button id="new-game-btn" class="neon-btn-blue control-btn">
            <i class="fas fa-plus mr-2"></i>æ–°æ¸¸æˆ
        </button>
        <button id="undo-btn" class="neon-btn-purple control-btn" disabled>
            <i class="fas fa-undo mr-2"></i>æ‚”æ£‹
        </button>
        <button id="settings-btn" class="neon-btn-pink control-btn">
            <i class="fas fa-cog mr-2"></i>è®¾ç½®
        </button>
    </div>
    
    <!-- è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="settings-modal" class="modal">
        <div class="modal-content neon-border-green">
            <span class="close-btn neon-text-pink">&times;</span>
            <h2 class="neon-text-green mb-4">æ¸¸æˆè®¾ç½®</h2>
            
            <div class="mb-6">
                <h3 class="neon-text-blue mb-2">æ¸¸æˆæ¨¡å¼</h3>
                <div class="flex justify-center">
                    <button id="pvp-mode" class="neon-btn-blue game-mode-btn">ç©å®¶ vs ç©å®¶</button>
                    <button id="pvc-mode" class="neon-btn-pink game-mode-btn">ç©å®¶ vs AI</button>
                </div>
            </div>
            
            <div id="ai-settings" class="mb-6">
                <h3 class="neon-text-blue mb-2">AIè®¾ç½®</h3>
                <div class="radio-container">
                    <div class="radio-option">
                        <input type="radio" id="first-move" name="move-order" value="first" checked>
                        <label for="first-move" class="neon-text-blue text-sm">å…ˆæ‰‹</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="second-move" name="move-order" value="second">
                        <label for="second-move" class="neon-text-pink text-sm">åæ‰‹</label>
                    </div>
                </div>
                
                <div class="difficulty-selector">
                    <label for="difficulty" class="neon-text-purple text-sm mb-2">AIéš¾åº¦</label>
                    <select id="difficulty" class="w-full mt-2">
                        <option value="easy">ç®€å•</option>
                        <option value="medium" selected>ä¸­ç­‰</option>
                        <option value="hard">å›°éš¾</option>
                    </select>
                </div>
            </div>
            
            <button id="start-game-btn" class="neon-btn-green w-full py-2 mt-4">
                <i class="fas fa-play mr-2"></i>å¼€å§‹æ¸¸æˆ
            </button>
        </div>
    </div>
    
    <!-- æ¸¸æˆç»“æŸæ¨¡æ€æ¡† -->
    <div id="game-over-modal" class="modal">
        <div class="modal-content neon-border-blue">
            <h2 id="game-over-title" class="neon-text-blue mb-4">æ¸¸æˆç»“æŸ</h2>
            <p id="game-over-message" class="mb-6">é»‘æ£‹è·èƒœ!</p>
            <div class="flex justify-center">
                <button id="play-again-btn" class="neon-btn-blue mr-4">å†ç©ä¸€æ¬¡</button>
                <button id="close-modal-btn" class="neon-btn-pink">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // æ¸¸æˆçŠ¶æ€
            const gameState = {
                boardSize: 15,
                gridSize: 0,
                cellSize: 0,
                gameMode: 'pvc', // 'pvp' or 'pvc'
                currentPlayer: 'black', // 'black' or 'white'
                board: [],
                moves: [],
                gameOver: false,
                aiDifficulty: 'medium',
                playerFirst: true,
                winLine: null
            };
            
            // DOMå…ƒç´ 
            const boardElement = document.querySelector('.board');
            const blackPlayerElement = document.getElementById('black-player');
            const whitePlayerElement = document.getElementById('white-player');
            const blackNameElement = document.getElementById('black-name');
            const whiteNameElement = document.getElementById('white-name');
            const gameStatusElement = document.getElementById('game-status');
            const newGameBtn = document.getElementById('new-game-btn');
            const undoBtn = document.getElementById('undo-btn');
            const settingsBtn = document.getElementById('settings-btn');
            const settingsModal = document.getElementById('settings-modal');
            const closeModalBtn = document.querySelector('.close-btn');
            const pvpModeBtn = document.getElementById('pvp-mode');
            const pvcModeBtn = document.getElementById('pvc-mode');
            const firstMoveRadio = document.getElementById('first-move');
            const secondMoveRadio = document.getElementById('second-move');
            const difficultySelect = document.getElementById('difficulty');
            const startGameBtn = document.getElementById('start-game-btn');
            const gameOverModal = document.getElementById('game-over-modal');
            const gameOverTitle = document.getElementById('game-over-title');
            const gameOverMessage = document.getElementById('game-over-message');
            const playAgainBtn = document.getElementById('play-again-btn');
            const closeModalBtn2 = document.getElementById('close-modal-btn');
            
            // åˆå§‹åŒ–æ¸¸æˆ
            function initGame() {
                // è®¡ç®—æ ¼å­å¤§å°
                gameState.gridSize = gameState.boardSize - 1;
                gameState.cellSize = boardElement.offsetWidth / gameState.gridSize;
                
                // æ¸…ç©ºæ£‹ç›˜
                boardElement.innerHTML = '';
                
                // åˆå§‹åŒ–æ£‹ç›˜æ•°ç»„
                gameState.board = Array(gameState.boardSize).fill().map(() => Array(gameState.boardSize).fill(null));
                gameState.moves = [];
                gameState.gameOver = false;
                gameState.winLine = null;
                
                // ç»˜åˆ¶æ£‹ç›˜ç½‘æ ¼
                drawBoard();
                
                // è®¾ç½®ç©å®¶ä¿¡æ¯
                updatePlayerInfo();
                
                // å¦‚æœæ˜¯AIå…ˆæ‰‹ï¼Œè®©AIèµ°ç¬¬ä¸€æ­¥
                if (gameState.gameMode === 'pvc' && !gameState.playerFirst) {
                    setTimeout(() => {
                        makeAIMove();
                    }, 500);
                }
                
                // æ›´æ–°æ¸¸æˆçŠ¶æ€
                gameStatusElement.textContent = 'æ¸¸æˆä¸­';
                undoBtn.disabled = true;
            }
            
            // ç»˜åˆ¶æ£‹ç›˜
            function drawBoard() {
                // ç»˜åˆ¶ç½‘æ ¼çº¿
                for (let i = 0; i < gameState.boardSize; i++) {
                    // æ¨ªçº¿
                    const hLine = document.createElement('div');
                    hLine.className = 'grid-line';
                    hLine.style.width = `${boardElement.offsetWidth}px`;
                    hLine.style.height = '1px';
                    hLine.style.top = `${i * gameState.cellSize}px`;
                    hLine.style.left = '0';
                    boardElement.appendChild(hLine);
                    
                    // ç«–çº¿
                    const vLine = document.createElement('div');
                    vLine.className = 'grid-line';
                    vLine.style.width = '1px';
                    vLine.style.height = `${boardElement.offsetHeight}px`;
                    vLine.style.left = `${i * gameState.cellSize}px`;
                    vLine.style.top = '0';
                    boardElement.appendChild(vLine);
                }
                
                // ç»˜åˆ¶æ˜Ÿä½ç‚¹
                const starPoints = [
                    [3, 3], [3, 11], [7, 7], [11, 3], [11, 11]
                ];
                
                starPoints.forEach(point => {
                    const star = document.createElement('div');
                    star.className = 'piece';
                    star.style.width = `${gameState.cellSize * 0.2}px`;
                    star.style.height = `${gameState.cellSize * 0.2}px`;
                    star.style.backgroundColor = 'rgba(255, 255, 255, 0.7)';
                    star.style.left = `${point[0] * gameState.cellSize}px`;
                    star.style.top = `${point[1] * gameState.cellSize}px`;
                    boardElement.appendChild(star);
                });
            }
            
            // ç»˜åˆ¶æ£‹å­
            function drawPiece(row, col, player) {
                const piece = document.createElement('div');
                piece.className = `piece ${player}-piece`;
                piece.style.width = `${gameState.cellSize * 0.9}px`;
                piece.style.height = `${gameState.cellSize * 0.9}px`;
                piece.style.left = `${col * gameState.cellSize}px`;
                piece.style.top = `${row * gameState.cellSize}px`;
                
                // å¦‚æœæ˜¯æœ€åä¸€æ­¥ï¼Œæ·»åŠ é—ªçƒæ•ˆæœ
                if (gameState.moves.length > 0) {
                    const lastMove = gameState.moves[gameState.moves.length - 1];
                    if (lastMove.row === row && lastMove.col === col) {
                        piece.classList.add('last-move');
                        piece.classList.add('neon');
                    }
                }
                
                boardElement.appendChild(piece);
            }
            
            // å¤„ç†ç‚¹å‡»æ£‹ç›˜äº‹ä»¶
            function handleBoardClick(e) {
                if (gameState.gameOver) return;
                
                // å¦‚æœæ˜¯AIå›åˆä¸”æ˜¯PVEæ¨¡å¼ï¼Œå¿½ç•¥ç‚¹å‡»
                if (gameState.gameMode === 'pvc' && gameState.currentPlayer === 'white' && !gameState.playerFirst) return;
                if (gameState.gameMode === 'pvc' && gameState.currentPlayer === 'black' && gameState.playerFirst) return;
                
                const rect = boardElement.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // è®¡ç®—ç‚¹å‡»çš„æ ¼å­åæ ‡
                const col = Math.round(x / gameState.cellSize);
                const row = Math.round(y / gameState.cellSize);
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ•ˆç§»åŠ¨
                if (isValidMove(row, col)) {
                    makeMove(row, col);
                    
                    // å¦‚æœæ˜¯PVEæ¨¡å¼ä¸”æ¸¸æˆæœªç»“æŸï¼Œè®©AIèµ°ä¸‹ä¸€æ­¥
                    if (gameState.gameMode === 'pvc' && !gameState.gameOver) {
                        setTimeout(() => {
                            makeAIMove();
                        }, 500);
                    }
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆç§»åŠ¨
            function isValidMove(row, col) {
                // æ£€æŸ¥æ˜¯å¦åœ¨æ£‹ç›˜èŒƒå›´å†…
                if (row < 0 || row >= gameState.boardSize || col < 0 || col >= gameState.boardSize) {
                    return false;
                }
                
                // æ£€æŸ¥è¯¥ä½ç½®æ˜¯å¦å·²æœ‰æ£‹å­
                return gameState.board[row][col] === null;
            }
            
            // æ‰§è¡Œç§»åŠ¨
            function makeMove(row, col) {
                // æ›´æ–°æ£‹ç›˜æ•°ç»„
                gameState.board[row][col] = gameState.currentPlayer;
                
                // è®°å½•ç§»åŠ¨
                gameState.moves.push({
                    row: row,
                    col: col,
                    player: gameState.currentPlayer
                });
                
                // ç»˜åˆ¶æ£‹å­
                drawPiece(row, col, gameState.currentPlayer);
                
                // æ£€æŸ¥æ˜¯å¦è·èƒœ
                if (checkWin(row, col)) {
                    gameState.gameOver = true;
                    showWinLine(row, col);
                    showGameOver(`${gameState.currentPlayer === 'black' ? 'é»‘æ£‹' : 'ç™½æ£‹'}è·èƒœ!`);
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦å¹³å±€
                if (gameState.moves.length === gameState.boardSize * gameState.boardSize) {
                    gameState.gameOver = true;
                    showGameOver('å¹³å±€!');
                    return;
                }
                
                // åˆ‡æ¢ç©å®¶
                gameState.currentPlayer = gameState.currentPlayer === 'black' ? 'white' : 'black';
                
                // æ›´æ–°ç©å®¶ä¿¡æ¯
                updatePlayerInfo();
                
                // å¯ç”¨æ‚”æ£‹æŒ‰é’®
                undoBtn.disabled = false;
            }
            
            // AIç§»åŠ¨
            function makeAIMove() {
                if (gameState.gameOver) return;
                
                let row, col;
                
                // æ ¹æ®éš¾åº¦é€‰æ‹©AIç­–ç•¥
                switch (gameState.aiDifficulty) {
                    case 'easy':
                        // ç®€å•AI: éšæœºèµ°æ£‹
                        [row, col] = makeRandomMove();
                        break;
                    case 'medium':
                        // ä¸­ç­‰AI: æœ‰ä¸€å®šç­–ç•¥
                        [row, col] = makeMediumMove();
                        break;
                    case 'hard':
                        // å›°éš¾AI: ä½¿ç”¨æ›´å¤æ‚çš„ç­–ç•¥
                        [row, col] = makeHardMove();
                        break;
                    default:
                        [row, col] = makeMediumMove();
                }
                
                makeMove(row, col);
            }
            
            // éšæœºèµ°æ£‹
            function makeRandomMove() {
                let row, col;
                do {
                    row = Math.floor(Math.random() * gameState.boardSize);
                    col = Math.floor(Math.random() * gameState.boardSize);
                } while (!isValidMove(row, col));
                
                return [row, col];
            }
            
            // ä¸­ç­‰AIèµ°æ£‹
            function makeMediumMove() {
                // é¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰å¯ä»¥ç«‹å³è·èƒœçš„èµ°æ³•
                for (let i = 0; i < gameState.boardSize; i++) {
                    for (let j = 0; j < gameState.boardSize; j++) {
                        if (isValidMove(i, j)) {
                            gameState.board[i][j] = 'white';
                            if (checkWin(i, j)) {
                                gameState.board[i][j] = null;
                                return [i, j];
                            }
                            gameState.board[i][j] = null;
                        }
                    }
                }
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦é˜»æ­¢å¯¹æ‰‹è·èƒœ
                for (let i = 0; i < gameState.boardSize; i++) {
                    for (let j = 0; j < gameState.boardSize; j++) {
                        if (isValidMove(i, j)) {
                            gameState.board[i][j] = 'black';
                            if (checkWin(i, j)) {
                                gameState.board[i][j] = null;
                                return [i, j];
                            }
                            gameState.board[i][j] = null;
                        }
                    }
                }
                
                // å¦‚æœæ²¡æœ‰ç«‹å³è·èƒœæˆ–é˜»æ­¢çš„èµ°æ³•ï¼Œå°è¯•åœ¨ä¸­å¿ƒåŒºåŸŸèµ°æ£‹
                const center = Math.floor(gameState.boardSize / 2);
                if (isValidMove(center, center)) {
                    return [center, center];
                }
                
                // å¦åˆ™éšæœºèµ°æ£‹
                return makeRandomMove();
            }
            
            // å›°éš¾AIèµ°æ£‹
            function makeHardMove() {
                // é¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰å¯ä»¥ç«‹å³è·èƒœçš„èµ°æ³•
                for (let i = 0; i < gameState.boardSize; i++) {
                    for (let j = 0; j < gameState.boardSize; j++) {
                        if (isValidMove(i, j)) {
                            gameState.board[i][j] = 'white';
                            if (checkWin(i, j)) {
                                gameState.board[i][j] = null;
                                return [i, j];
                            }
                            gameState.board[i][j] = null;
                        }
                    }
                }
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦é˜»æ­¢å¯¹æ‰‹è·èƒœ
                for (let i = 0; i < gameState.boardSize; i++) {
                    for (let j = 0; j < gameState.boardSize; j++) {
                        if (isValidMove(i, j)) {
                            gameState.board[i][j] = 'black';
                            if (checkWin(i, j)) {
                                gameState.board[i][j] = null;
                                return [i, j];
                            }
                            gameState.board[i][j] = null;
                        }
                    }
                }
                
                // å°è¯•åˆ›å»ºæˆ–æ‰©å±•è‡ªå·±çš„è¿çº¿
                const bestMove = findBestMove();
                if (bestMove) {
                    return bestMove;
                }
                
                // å¦åˆ™ä½¿ç”¨ä¸­ç­‰AIçš„ç­–ç•¥
                return makeMediumMove();
            }
            
            // è¯„ä¼°æ£‹ç›˜å¹¶æ‰¾åˆ°æœ€ä½³ç§»åŠ¨
            function findBestMove() {
                let bestScore = -Infinity;
                let bestMove = null;
                
                for (let i = 0; i < gameState.boardSize; i++) {
                    for (let j = 0; j < gameState.boardSize; j++) {
                        if (isValidMove(i, j)) {
                            // å°è¯•åœ¨æ­¤ä½ç½®ä¸‹å­
                            gameState.board[i][j] = 'white';
                            
                            // è¯„ä¼°è¿™ä¸ªä½ç½®
                            const score = evaluatePosition(i, j, 'white');
                            
                            // æ’¤é”€ç§»åŠ¨
                            gameState.board[i][j] = null;
                            
                            if (score > bestScore) {
                                bestScore = score;
                                bestMove = [i, j];
                            }
                        }
                    }
                }
                
                return bestMove;
            }
            
            // è¯„ä¼°ä½ç½®å¾—åˆ†
            function evaluatePosition(row, col, player) {
                let score = 0;
                
                // æ£€æŸ¥å››ä¸ªæ–¹å‘
                const directions = [
                    [0, 1],   // æ°´å¹³
                    [1, 0],   // å‚ç›´
                    [1, 1],   // å¯¹è§’çº¿
                    [1, -1]   // åå¯¹è§’çº¿
                ];
                
                directions.forEach(([dx, dy]) => {
                    let count = 1; // å½“å‰ä½ç½®å·²ç»æœ‰ä¸€ä¸ªå­
                    let openEnds = 0;
                    
                    // å‘ä¸€ä¸ªæ–¹å‘æ£€æŸ¥
                    let r = row + dx;
                    let c = col + dy;
                    while (r >= 0 && r < gameState.boardSize && c >= 0 && c < gameState.boardSize && gameState.board[r][c] === player) {
                        count++;
                        r += dx;
                        c += dy;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦å¼€æ”¾
                    if (r >= 0 && r < gameState.boardSize && c >= 0 && c < gameState.boardSize && gameState.board[r][c] === null) {
                        openEnds++;
                    }
                    
                    // å‘å¦ä¸€ä¸ªæ–¹å‘æ£€æŸ¥
                    r = row - dx;
                    c = col - dy;
                    while (r >= 0 && r < gameState.boardSize && c >= 0 && c < gameState.boardSize && gameState.board[r][c] === player) {
                        count++;
                        r -= dx;
                        c -= dy;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦å¼€æ”¾
                    if (r >= 0 && r < gameState.boardSize && c >= 0 && c < gameState.boardSize && gameState.board[r][c] === null) {
                        openEnds++;
                    }
                    
                    // æ ¹æ®è¿å­æ•°å’Œå¼€æ”¾ç«¯è¯„åˆ†
                    if (count >= 5) {
                        score += 100000; // äº”è¿ç 
                    } else if (count === 4) {
                        if (openEnds === 2) score += 10000; // æ´»å››
                        else if (openEnds === 1) score += 1000; // å†²å››
                    } else if (count === 3) {
                        if (openEnds === 2) score += 500; // æ´»ä¸‰
                        else if (openEnds === 1) score += 100; // å†²ä¸‰
                    } else if (count === 2) {
                        if (openEnds === 2) score += 50; // æ´»äºŒ
                        else if (openEnds === 1) score += 10; // å†²äºŒ
                    }
                });
                
                return score;
            }
            
            // æ£€æŸ¥æ˜¯å¦è·èƒœ
            function checkWin(row, col) {
                const player = gameState.board[row][col];
                const directions = [
                    [0, 1],   // æ°´å¹³
                    [1, 0],   // å‚ç›´
                    [1, 1],   // å¯¹è§’çº¿
                    [1, -1]   // åå¯¹è§’çº¿
                ];
                
                for (const [dx, dy] of directions) {
                    let count = 1;
                    
                    // å‘ä¸€ä¸ªæ–¹å‘æ£€æŸ¥
                    let r = row + dx;
                    let c = col + dy;
                    while (r >= 0 && r < gameState.boardSize && c >= 0 && c < gameState.boardSize && gameState.board[r][c] === player) {
                        count++;
                        r += dx;
                        c += dy;
                    }
                    
                    // å‘å¦ä¸€ä¸ªæ–¹å‘æ£€æŸ¥
                    r = row - dx;
                    c = col - dy;
                    while (r >= 0 && r < gameState.boardSize && c >= 0 && c < gameState.boardSize && gameState.board[r][c] === player) {
                        count++;
                        r -= dx;
                        c -= dy;
                    }
                    
                    if (count >= 5) {
                        return true;
                    }
                }
                
                return false;
            }
            
            // æ˜¾ç¤ºè·èƒœçº¿
            function showWinLine(row, col) {
                const player = gameState.board[row][col];
                const directions = [
                    [0, 1],   // æ°´å¹³
                    [1, 0],   // å‚ç›´
                    [1, 1],   // å¯¹è§’çº¿
                    [1, -1]   // åå¯¹è§’çº¿
                ];
                
                for (const [dx, dy] of directions) {
                    let count = 1;
                    
                    // å‘ä¸€ä¸ªæ–¹å‘æ£€æŸ¥
                    let r = row + dx;
                    let c = col + dy;
                    while (r >= 0 && r < gameState.boardSize && c >= 0 && c < gameState.boardSize && gameState.board[r][c] === player) {
                        count++;
                        r += dx;
                        c += dy;
                    }
                    
                    // å‘å¦ä¸€ä¸ªæ–¹å‘æ£€æŸ¥
                    let startR = row;
                    let startC = col;
                    r = row - dx;
                    c = col - dy;
                    while (r >= 0 && r < gameState.boardSize && c >= 0 && c < gameState.boardSize && gameState.board[r][c] === player) {
                        count++;
                        startR = r;
                        startC = c;
                        r -= dx;
                        c -= dy;
                    }
                    
                    if (count >= 5) {
                        // åˆ›å»ºè·èƒœçº¿
                        const line = document.createElement('div');
                        line.className = 'win-line';
                        
                        // è®¡ç®—çº¿çš„é•¿åº¦å’Œè§’åº¦
                        const endR = startR + (count - 1) * dx;
                        const endC = startC + (count - 1) * dy;
                        
                        const startX = startC * gameState.cellSize;
                        const startY = startR * gameState.cellSize;
                        const endX = endC * gameState.cellSize;
                        const endY = endR * gameState.cellSize;
                        
                        const length = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                        const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI;
                        
                        line.style.width = `${length}px`;
                        line.style.height = '4px';
                        line.style.left = `${startX}px`;
                        line.style.top = `${startY}px`;
                        line.style.transform = `rotate(${angle}deg)`;
                        
                        boardElement.appendChild(line);
                        gameState.winLine = line;
                        return;
                    }
                }
            }
            
            // æ‚”æ£‹
            function undoMove() {
                if (gameState.moves.length === 0 || gameState.gameOver) return;
                
                // ç§»é™¤æœ€åä¸€æ­¥
                const lastMove = gameState.moves.pop();
                gameState.board[lastMove.row][lastMove.col] = null;
                
                // é‡æ–°ç»˜åˆ¶æ£‹ç›˜
                boardElement.querySelectorAll('.piece').forEach(piece => piece.remove());
                
                // é‡æ–°ç»˜åˆ¶æ‰€æœ‰æ£‹å­
                gameState.moves.forEach(move => {
                    drawPiece(move.row, move.col, move.player);
                });
                
                // åˆ‡æ¢å½“å‰ç©å®¶
                gameState.currentPlayer = gameState.currentPlayer === 'black' ? 'white' : 'black';
                
                // æ›´æ–°ç©å®¶ä¿¡æ¯
                updatePlayerInfo();
                
                // å¦‚æœæ‚”æ£‹åæ²¡æœ‰æ­¥æ•°ï¼Œç¦ç”¨æ‚”æ£‹æŒ‰é’®
                undoBtn.disabled = gameState.moves.length === 0;
                
                // ç§»é™¤è·èƒœçº¿
                if (gameState.winLine) {
                    gameState.winLine.remove();
                    gameState.winLine = null;
                }
                
                // é‡ç½®æ¸¸æˆç»“æŸçŠ¶æ€
                gameState.gameOver = false;
                gameStatusElement.textContent = 'æ¸¸æˆä¸­';
            }
            
            // æ›´æ–°ç©å®¶ä¿¡æ¯
            function updatePlayerInfo() {
                // é‡ç½®æ‰€æœ‰ç©å®¶çŠ¶æ€
                blackPlayerElement.classList.remove('active-player');
                whitePlayerElement.classList.remove('active-player');
                whitePlayerElement.classList.remove('active-player', 'white');
                
                // è®¾ç½®å½“å‰æ´»è·ƒç©å®¶
                if (gameState.currentPlayer === 'black') {
                    blackPlayerElement.classList.add('active-player');
                } else {
                    whitePlayerElement.classList.add('active-player', 'white');
                }
                
                // æ›´æ–°ç©å®¶åç§°
                if (gameState.gameMode === 'pvp') {
                    blackNameElement.textContent = 'ç©å®¶1';
                    whiteNameElement.textContent = 'ç©å®¶2';
                } else {
                    blackNameElement.textContent = gameState.playerFirst ? 'ç©å®¶' : 'AI';
                    whiteNameElement.textContent = gameState.playerFirst ? 'AI' : 'ç©å®¶';
                }
            }
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸæ¨¡æ€æ¡†
            function showGameOver(message) {
                gameOverTitle.textContent = 'æ¸¸æˆç»“æŸ';
                gameOverMessage.textContent = message;
                gameOverModal.style.display = 'flex';
                gameStatusElement.textContent = 'æ¸¸æˆç»“æŸ';
            }
            
            // äº‹ä»¶ç›‘å¬å™¨
            boardElement.addEventListener('click', handleBoardClick);
            newGameBtn.addEventListener('click', initGame);
            undoBtn.addEventListener('click', undoMove);
            settingsBtn.addEventListener('click', () => {
                settingsModal.style.display = 'flex';
            });
            closeModalBtn.addEventListener('click', () => {
                settingsModal.style.display = 'none';
            });
            pvpModeBtn.addEventListener('click', () => {
                gameState.gameMode = 'pvp';
                pvpModeBtn.classList.add('neon-btn-blue');
                pvpModeBtn.classList.remove('neon-btn-pink');
                pvcModeBtn.classList.remove('neon-btn-blue');
                pvcModeBtn.classList.add('neon-btn-pink');
                document.getElementById('ai-settings').style.display = 'none';
            });
            pvcModeBtn.addEventListener('click', () => {
                gameState.gameMode = 'pvc';
                pvcModeBtn.classList.add('neon-btn-pink');
                pvcModeBtn.classList.remove('neon-btn-blue');
                pvpModeBtn.classList.remove('neon-btn-pink');
                pvpModeBtn.classList.add('neon-btn-blue');
                document.getElementById('ai-settings').style.display = 'block';
            });
            startGameBtn.addEventListener('click', () => {
                if (gameState.gameMode === 'pvc') {
                    gameState.playerFirst = firstMoveRadio.checked;
                    gameState.aiDifficulty = difficultySelect.value;
                }
                settingsModal.style.display = 'none';
                initGame();
            });
            playAgainBtn.addEventListener('click', () => {
                gameOverModal.style.display = 'none';
                initGame();
            });
            closeModalBtn2.addEventListener('click', () => {
                gameOverModal.style.display = 'none';
            });
            
            // åˆå§‹åŒ–è®¾ç½®
            pvpModeBtn.classList.add('neon-btn-blue');
            pvcModeBtn.classList.add('neon-btn-pink');
            document.getElementById('ai-settings').style.display = 'none';
            
            // å¼€å§‹æ¸¸æˆ
            initGame();
        });
    </script>
<p style="border-radius: 8px; text-align: center; font-size: 12px; color: #fff; margin-top: 16px;position: fixed; left: 8px; bottom: 8px; z-index: 10; background: rgba(0, 0, 0, 0.8); padding: 4px 8px;">Made with <img src="https://enzostvs-deepsite.hf.space/logo.svg" alt="DeepSite Logo" style="width: 16px; height: 16px; vertical-align: middle;display:inline-block;margin-right:3px;filter:brightness(0) invert(1);"><a href="https://enzostvs-deepsite.hf.space" style="color: #fff;text-decoration: underline;" target="_blank" >DeepSite</a> - ğŸ§¬ <a href="https://enzostvs-deepsite.hf.space?remix=KuRRe8/neon-gobang" style="color: #fff;text-decoration: underline;" target="_blank" >Remix</a></p></body>
</html>
